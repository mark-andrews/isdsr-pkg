% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/regressions.R
\name{lm_diagnostic_plot}
\alias{lm_diagnostic_plot}
\title{Visual diagnostics for linear models: residuals, Q–Q, scale–location, leverage, and histogram}
\usage{
lm_diagnostic_plot(
  model,
  type = c("resid", "qq", "scale", "lev", "hist"),
  alpha = 0.7
)
}
\arguments{
\item{model}{An \code{lm} object.}

\item{type}{One of:
\itemize{
\item \code{"resid"} — residuals vs fitted (with a loess smooth).
\item \code{"qq"} — Q–Q plot of standardised residuals with reference line.
\item \code{"scale"} — scale–location plot \eqn{\sqrt{|r_i|}}{sqrt(|r_i|)} vs fitted.
\item \code{"lev"} — standardised residuals vs leverage, with reference lines; point size indicates Cook’s distance.
\item \code{"hist"} — histogram of residuals with normal density overlay.
}}

\item{alpha}{Point transparency for scatter plots (default \code{0.7}).}
}
\value{
A \code{ggplot} object, which you can further customise.
}
\description{
Produce one of five standard diagnostic plots for a fitted \code{lm} model
using \pkg{ggplot2} layers and \pkg{broom}’s augmented data.
These plots help check the core assumptions of the normal linear model:
a linear conditional mean, errors centred at zero, roughly constant variance,
and error distributions close enough to normal for small‑sample \eqn{t}-based inference.
}
\details{
The function draws one of five plots, selected via \code{type}.

\strong{1) \code{type = "resid"} — Residuals vs fitted}

Raw residuals \eqn{\hat\varepsilon_i = y_i - \hat y_i} versus fitted values \eqn{\hat y_i}.
A well‑specified model shows a roughly horizontal band around 0 with no systematic pattern.

\emph{What to look for}
\itemize{
\item \emph{Linearity:} Curvature suggests the conditional mean is not linear in \eqn{x}.
\item \emph{Constant variance:} Funnel shapes indicate heteroskedasticity.
\item \emph{Outliers / structure:} Large vertical distances or clustered stripes merit investigation.
}

\strong{2) \code{type = "qq"} — Normal Q–Q of standardised residuals}

Ordered standardised residuals against theoretical normal quantiles with a reference line.
Points close to the line indicate approximate normality; tail bending indicates heavy tails; an S‑shape indicates skewness.

\strong{3) \code{type = "scale"} — Scale–location}

Plots \eqn{\sqrt{|r_i|}}{sqrt(|r_i|)} versus fitted values, where \eqn{r_i} are standardised residuals.
A flat band supports constant variance; upward or downward trends suggest heteroskedasticity.

\strong{4) \code{type = "lev"} — Standardised residuals vs leverage}

Standardised residuals (\code{.std.resid}) versus leverage (\code{.hat}).
A vertical reference line is drawn at \eqn{2p/n}, where \eqn{p} is the number of coefficients
(including the intercept) and \eqn{n} is the sample size.
Horizontal lines at \eqn{\pm 2}{+/- 2} mark unusually large residuals.
Point size encodes Cook’s distance (\code{.cooksd}) to cue overall influence.

\emph{Reading the plot}
\itemize{
\item Right of \eqn{2p/n} with small residuals: high leverage but not influential.
\item Right of \eqn{2p/n} and beyond \eqn{|2|}{2}: candidates for strong influence.
}

\strong{5) \code{type = "hist"} — Histogram of residuals with normal overlay}

Histogram of raw residuals on a density scale, overlaid with the normal density
\eqn{N(0, \sigma^2)} where \eqn{\sigma} is the residual standard deviation
(\code{sigma(model)}). A symmetric, bell‑shaped histogram centred at 0 that
roughly follows the red curve supports the normal‑error assumption; visible skew
or heavier‑than‑normal tails point to departures that may affect small‑sample inference.

\strong{General guidance}
\itemize{
\item Normality mainly affects small‑sample accuracy of p‑values and intervals;
linearity and constant variance affect bias and coverage at any size.
\item Diagnostics prompt investigation; decisions should consider context and
subject‑matter knowledge rather than fixed rules.
}
}
\examples{
fit <- lm(mpg ~ wt, data = mtcars)
lm_diagnostic_plot(fit, "resid")
lm_diagnostic_plot(fit, "qq")
lm_diagnostic_plot(fit, "scale")
lm_diagnostic_plot(fit, "lev")
lm_diagnostic_plot(fit, "hist")
}
\seealso{
\code{stats::plot.lm()} for the classic base‑R set (includes leverage and Cook’s contours);
\pkg{broom} \code{augment()} for the columns used here.
}
